# Migration Dockerfile
FROM node:22-alpine

WORKDIR /app

# Copy package files
COPY package.json pnpm-workspace.yaml pnpm-lock.yaml* ./
COPY packages/database/package.json ./packages/database/

# Install pnpm
RUN npm install -g pnpm

# Install dependencies
ENV CI=true
RUN pnpm install --frozen-lockfile

# Copy database package
COPY packages/database ./packages/database

# Run migrations
WORKDIR /app/packages/database
CMD ["pnpm", "run", "migrate"]
